<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bafuta Search</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    html, body {
      height: 100%;
    }
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #202124;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      color: #e8eaed;
      display: flex;
      flex-direction: column;
    }
    header {
      width: 100vw;
      background: #202124;
      text-align: right;
      padding: 1.2em 2.2em 0.4em 0;
      font-size: 0.98em;
      color: #e8eaed;
      letter-spacing: 0.015em;
    }
    .main-wrapper {
      flex: 1 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 0;
      width: 100%;
    }
    #main-box {
      width: 100vw;
      max-width: 700px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .bafuta-logo {
      font-family: 'Product Sans', Arial, Helvetica, sans-serif;
      font-size: 4.2em;
      font-weight: 700;
      margin: 0 0 12px 0;
      letter-spacing: -2px;
      background: linear-gradient(90deg, #8ab4f8 10%, #f8f9fa 32%, #fbbc04 48%, #34a853 65%, #ea4335 84%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      color: #8ab4f8;
      text-align: center;
      user-select: none;
    }
    .logo-dot {
      color: #34a853;
      font-size: 1.2em;
      vertical-align: super;
      margin-left: 3px;
      user-select: none;
    }
    #searchbar-form {
      width: 100%;
      display: flex;
      justify-content: center;
    }
    #searchbar {
      width: 100%;
      max-width: 580px;
      font-size: 1.35em;
      padding: 15px 22px;
      border: none;
      border-radius: 28px;
      background: #303134;
      color: #e8eaed;
      outline: none;
      box-shadow: 0 2px 4px #1112, 0 2px 15px #1112;
      transition: box-shadow .18s, border-color .2s;
      margin: 0 8px 0 0;
      border: 1.5px solid #303134;
    }
    #searchbar:focus {
      border: 1.5px solid #8ab4f8;
      background: #202124;
    }
    .search-btn {
      font-size: 1.05em;
      padding: 12px 26px;
      margin: 0 3px;
      background: #303134;
      color: #e8eaed;
      border: 1px solid #303134;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: background 0.15s, color 0.1s, border .13s;
    }
    .search-btn:hover, .search-btn:focus {
      background: #35363a;
      border: 1px solid #8ab4f8;
      color: #8ab4f8;
    }
    #quick-links {
      margin-top: 1.5em;
      margin-bottom: 1em;
      width: 100%;
      max-width: 600px;
      text-align: center;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.65em;
    }
    .quick-link {
      background: #292a2d;
      color: #8ab4f8;
      border-radius: 8px;
      padding: 0.55em 1.2em;
      font-size: 1.06em;
      text-decoration: none;
      margin-bottom: 4px;
      transition: background 0.17s, color 0.17s;
      border: 1px solid #292a2d;
      display: inline-block;
    }
    .quick-link:hover {
      background: #35363a;
      color: #fbbc04;
      border-color: #8ab4f8;
      text-decoration: underline;
    }
    #results {
      margin-top: 2.3em;
      width: 100%;
      max-width: 620px;
      min-height: 120px;
      background: #1a1a1a;
      border-radius: 12px;
      padding: 1.4em 2em 1.2em 2em;
      font-size: 1.08em;
      box-shadow: 0 2px 12px #000a;
      animation: fadein 0.43s;
      color: #e8eaed;
    }
    @keyframes fadein {
      from { opacity: 0; transform: translateY(15px);}
      to { opacity: 1; transform: none;}
    }
    .result-title {
      font-size: 1.19em;
      color: #8ab4f8;
      margin-bottom: 2px;
      font-weight: 500;
      letter-spacing: 0.01em;
      text-decoration: none;
      display: block;
      cursor: pointer;
      line-height: 1.28;
    }
    .result-title:hover {
      text-decoration: underline;
      color: #fbbc04;
    }
    .result-snippet {
      color: #e8eaed;
      margin-bottom: 7px;
      font-size: 1.01em;
      line-height: 1.5;
    }
    .result-url {
      color: #34a853;
      font-size: 0.95em;
      margin-bottom: 16px;
      word-break: break-all;
      opacity: 0.85;
      margin-top: 1px;
    }
    .result-row {
      padding: 0.6em 0 0.6em 0;
      border-bottom: 1px solid #303134;
    }
    .result-row:last-child {
      border-bottom: none;
    }
    .instant-answer {
      background: #292a2d;
      border-radius: 10px;
      padding: 0.57em 1em 0.72em 1em;
      margin-bottom: 1.1em;
      color: #fbbc04;
      font-size: 1.13em;
      font-weight: 500;
      border-left: 4px solid #8ab4f8;
      box-shadow: 0 1px 8px #18181830;
    }
    ::placeholder {
      color: #b3b3b3;
      opacity: 1;
    }
    #iframe-container {
      margin: 35px auto 0 auto;
      width: 100%;
      max-width: 1200px;
      min-height: 540px;
      height: 72vh;
      border-radius: 18px;
      background: #111;
      box-shadow: 0 4px 32px #101010c0;
      overflow: hidden;
      display: none;
      flex-direction: column;
      align-items: stretch;
      position: relative;
    }
    #browser-bar {
      background: #292a2d;
      border-bottom: 1px solid #222;
      padding: 8px 18px;
      font-size: 1.07em;
      color: #8ab4f8;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    #browser-url {
      background: #181818;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 6px 12px;
      width: 70%;
      font-size: 1em;
    }
    #close-iframe {
      background: #fbbc04;
      color: #222;
      border: none;
      border-radius: 7px;
      padding: 7px 14px;
      cursor: pointer;
      font-size: 1em;
      margin-left: auto;
      font-weight: 600;
      transition: background 0.13s, color 0.13s;
    }
    #close-iframe:hover {
      background: #ea4335;
      color: #fff;
    }
    #site-iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: #1a1a1a;
      flex: 1 1 auto;
    }
    .iframe-fallback {
      color: #ef4444;
      background: #1a1a1a;
      text-align: center;
      padding: 2.5em 1em;
      font-size: 1.12em;
      border-radius: 12px;
      margin: 0 auto;
    }
    @media (max-width: 850px) {
      .main-wrapper { padding: 10px 0 0 0; }
      #main-box { max-width: 100vw; }
      #results {max-width:97vw; padding: 1.2em 1em;}
      #iframe-container { max-width: 99vw; height: 50vh; min-height: 240px;}
    }
    @media (max-width: 600px) {
      .main-wrapper {padding-top: 10vw;}
      .bafuta-logo {font-size: 2.6em;}
      #searchbar {font-size: 1em;}
      #iframe-container {min-height: 120px;}
    }
    #results::-webkit-scrollbar {display:none;}
    #results { -ms-overflow-style: none; scrollbar-width: none;}
  </style>
</head>
<body>
  <header>
    <span>Bafuta Search</span>
  </header>
  <div class="main-wrapper">
    <div id="main-box">
      <div class="bafuta-logo">Bafuta<span class="logo-dot">‚óè</span></div>
      <form id="searchbar-form" onsubmit="search(); return false;">
        <input id="searchbar" autocomplete="off" placeholder="Search Bafuta or type a URL" />
        <button type="submit" class="search-btn">Bafuta Search</button>
        <button type="button" class="search-btn" onclick="luckySearch()">I'm Feeling Lucky</button>
      </form>
      <!-- Quick Links Section -->
      <div id="quick-links">
        <a href="https://www.w3schools.com/" class="quick-link" target="_blank">W3Schools</a>
        <a href="https://example.com/" class="quick-link" target="_blank">Example.com</a>
        <a href="https://neverssl.com/" class="quick-link" target="_blank">NeverSSL</a>
        <a href="https://theuselessweb.com/" class="quick-link" target="_blank">The Useless Web</a>
        <a href="https://www.duckduckgo.com/" class="quick-link" target="_blank">DuckDuckGo</a>
        <a href="https://en.wikipedia.org/wiki/Main_Page" class="quick-link" target="_blank">Wikipedia</a>
        <a href="https://www.mozilla.org/en-US/" class="quick-link" target="_blank">Mozilla</a>
        <a href="https://www.stackoverflow.com/" class="quick-link" target="_blank">Stack Overflow</a>
        <a href="https://news.ycombinator.com/" class="quick-link" target="_blank">Hacker News</a>
        <a href="https://github.com/" class="quick-link" target="_blank">GitHub</a>
      </div>
      <div id="results">Type your query and press <b>Bafuta Search</b>!</div>
    </div>
    <div id="iframe-container">
      <div id="browser-bar">
        <span>üîó</span>
        <input id="browser-url" readonly value="">
        <button id="close-iframe" onclick="closeIframe()">Close</button>
      </div>
      <iframe id="site-iframe"></iframe>
      <div id="iframe-fallback" class="iframe-fallback" style="display:none;">
        Sorry, this site does not allow embedding.<br>
        <a id="fallback-link" href="#" target="_blank" style="color:#8ab4f8;text-decoration:underline;">Open in new tab</a>
      </div>
    </div>
  </div>
  <script>
    // Helper: Is this a URL?
    function isValidURL(string) {
      try {
        new URL(string);
        return true;
      } catch (_) { return false; }
    }

    async function search() {
      const q = document.getElementById('searchbar').value.trim();
      const resultsDiv = document.getElementById('results');
      closeIframe();
      if (!q) {
        resultsDiv.innerHTML = `<span style="color:#fde68a;">Please enter a search term above.</span>`;
        return;
      }
      // If user enters a URL, open directly in the browser
      if (/^(https?:\/\/|www\.)/i.test(q) || isValidURL('https://' + q)) {
        let url = q.match(/^https?:\/\//i) ? q : 'https://' + q;
        openPage(url);
        return false;
      }
      resultsDiv.innerHTML = `<span style="color:#8ab4f8;">Searching Bafuta...</span>`;
      const api = "https://api.duckduckgo.com/?q=" + encodeURIComponent(q) + "&format=json&pretty=1";
      try {
        const res = await fetch(api);
        if (!res.ok) throw new Error("DuckDuckGo API error");
        const data = await res.json();
        let html = "";
        if (data.AbstractText) {
          html += `<div class="instant-answer">${data.AbstractText}`;
          if (data.AbstractURL) {
            html += ` <a href="${data.AbstractURL}" style="color:#8ab4f8;" target="_blank">[Learn more]</a>`;
          }
          html += `</div>`;
        }
        if (data.RelatedTopics && data.RelatedTopics.length > 0) {
          let found = 0;
          data.RelatedTopics.forEach(topic => {
            if (topic.Topics) {
              topic.Topics.forEach(sub=>{
                if (sub.Text && sub.FirstURL) {
                  found++;
                  html += `<div class="result-row"><a class="result-title" href="#" onclick="return openPage('${sub.FirstURL}')" title="Open in browser">${sub.Text}</a>
                  <a class="result-url" href="${sub.FirstURL}" target="_blank" rel="noopener">${sub.FirstURL.replace(/^https?:\/\//,'')}</a></div>`;
                }
              });
            } else if (topic.Text && topic.FirstURL) {
              found++;
              html += `<div class="result-row"><a class="result-title" href="#" onclick="return openPage('${topic.FirstURL}')" title="Open in browser">${topic.Text}</a>
              <a class="result-url" href="${topic.FirstURL}" target="_blank" rel="noopener">${topic.FirstURL.replace(/^https?:\/\//,'')}</a></div>`;
            }
          });
          if (found === 0 && !data.AbstractText) html = `<span style="color:#fca5a5;">No results found. Try another search.</span>`;
        } else if (!data.AbstractText) {
          html = `<span style="color:#fca5a5;">No results found. Try another search.</span>`;
        }
        resultsDiv.innerHTML = html;
      } catch (e) {
        resultsDiv.innerHTML = `<span style="color:#f87171;">Sorry, there was a problem searching Bafuta.<br><i>${e}</i></span>`;
      }
      return false;
    }

    // I'm Feeling Lucky
    async function luckySearch() {
      const q = document.getElementById('searchbar').value.trim();
      closeIframe();
      if (!q) return;
      const api = "https://api.duckduckgo.com/?q=" + encodeURIComponent(q) + "&format=json&pretty=1";
      try {
        const res = await fetch(api);
        if (!res.ok) throw new Error("DuckDuckGo API error");
        const data = await res.json();
        let url = null;
        if (data.AbstractURL) url = data.AbstractURL;
        else if (data.RelatedTopics && data.RelatedTopics.length > 0) {
          let first = data.RelatedTopics[0];
          if (first.Topics && first.Topics[0] && first.Topics[0].FirstURL)
            url = first.Topics[0].FirstURL;
          else if (first.FirstURL) url = first.FirstURL;
        }
        if (url) {
          openPage(url);
        } else {
          document.getElementById('results').innerHTML = `<span style="color:#fca5a5;">No instant result found. Try another search.</span>`;
        }
      } catch (e) {
        document.getElementById('results').innerHTML = `<span style="color:#f87171;">Sorry, there was a problem searching Bafuta.<br><i>${e}</i></span>`;
      }
    }

    // Open page in iframe, handle framebusting with fallback
    function openPage(url) {
      document.getElementById('iframe-container').style.display = 'flex';
      document.getElementById('site-iframe').style.display = '';
      document.getElementById('iframe-fallback').style.display = 'none';
      document.getElementById('browser-url').value = url;
      document.getElementById('fallback-link').href = url;
      let iframe = document.getElementById('site-iframe');
      iframe.src = url;
      // If the site blocks iframe, show a fallback after a short timeout
      let fallbackTimer = setTimeout(() => {
        try {
          let doc = iframe.contentDocument || iframe.contentWindow.document;
          if (
            !doc.body ||
            (doc.body.innerHTML.trim() === '' && doc.URL === 'about:blank')
          ) {
            showIframeFallback(url);
          }
        } catch(e) {
          showIframeFallback(url);
        }
      }, 2300);
      iframe.onload = function() {
        clearTimeout(fallbackTimer);
        try {
          let doc = iframe.contentDocument || iframe.contentWindow.document;
          if (
            !doc.body ||
            (doc.body.innerHTML.trim() === '' && doc.URL === 'about:blank')
          ) {
            showIframeFallback(url);
          }
        } catch(e) {
          showIframeFallback(url);
        }
      };
      return false;
    }
    function showIframeFallback(url) {
      document.getElementById('site-iframe').style.display = 'none';
      document.getElementById('iframe-fallback').style.display = '';
      document.getElementById('fallback-link').href = url;
    }
    function closeIframe() {
      document.getElementById('iframe-container').style.display = 'none';
      document.getElementById('site-iframe').src = '';
      document.getElementById('iframe-fallback').style.display = 'none';
    }
    window.onload = () => {
      document.getElementById('searchbar').focus();
    };
  </script>
</body>
</html>
